<!doctype html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>test</title>
    <link rel="stylesheet" href="./bootstrap-icons-1.13.1/bootstrap-icons.css">
    <link rel="stylesheet" href="./bootstrap-5.3.8-dist/css/bootstrap.css">
    <link rel="stylesheet" href="./bootstrap-5.3.8-examples/modals/modals.css">
    <link rel="stylesheet" href="./SP_css/BS_SP_header.css">
    <link rel="stylesheet" href="./SP_css/BS_market_DB.css">


</head>

<body>

    <!-- header -->
    <header class="sticky-top">
        <nav class="p-2 navbar navbar-expand-lg navbar-dark bg-dark" aria-label="主導覽列">
            <div class="container">
                <a class="navbar-brand fs-3 mx-lg-0 me-lg-4 text-decoration-none text-white"
                    href="./SP_ver_1.html">財經網</a>

                <button class="btn btn-outline-light d-lg-none ms-auto me-3" type="button" id="sidebarToggleBtn"
                    data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
                    展開側邊欄
                </button>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                    aria-controls="mainNavbar" aria-expanded="false" aria-label="切換選單">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="mainNavbar">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li><a href="./SP_ver_1.html" class="nav-link px-2 text-white">首頁</a></li>
                        <li><a href="#" class="nav-link px-2 text-secondary active" aria-current="page">市場指數</a></li>
                        <li><a href="#" class="nav-link px-2 text-white">新聞</a></li>
                        <li><a href="#" class="nav-link px-2 text-white">觀點分析</a></li>
                        <li><a href="#" class="nav-link px-2 text-white">關於</a></li>
                    </ul>

                    <form class="d-flex align-items-center mb-3 mb-lg-0 me-lg-3" role="search">
                        <input type="search" class="form-control form-control-dark text-bg-dark search_p"
                            placeholder="搜尋..." aria-label="Search" />
                    </form>

                    <div class="d-flex flex-lg-row flex-column align-items-center">
                        <button type="button" class="btn btn-outline-light w-100 w-lg-auto mb-2 mb-lg-0 me-lg-2"
                            data-bs-toggle="modal" data-bs-target="#loginModal">登入</button>
                        <button type="button" class="btn btn-warning w-100 w-lg-auto mb-lg-0 mb-2 text-nowrap"
                            data-bs-toggle="modal" data-bs-target="#registerModal">
                            註冊會員
                        </button>
                    </div>

                </div>
            </div>
        </nav>
    </header>

    
    <!-- 側邊欄 + 主內容 -->
    <div class="container">
        <div class="row">
            <!-- Offcanvas 側邊欄，預設 d-lg-block（大螢幕）為靜態，d-lg-none（小螢幕）為 offcanvas -->
            <aside class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary d-none d-lg-block"
                id="sidebarStatic" style="top:56px;">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column" id="index-list">
                        <li class="nav-item">
                            <a class="nav-link d-flex justify-content-between align-items-center fw-semibold fs-5 group-toggle text-dark"
                                data-bs-toggle="collapse" href="#global-market-list" role="button" aria-expanded="true"
                                aria-controls="global-market-list" aria-label="切換全球股市群組" style="cursor:pointer;">
                                全球股市
                                <span class="bi bi-plus-circle"></span>
                            </a>
                            <div class="collapse show" id="global-market-list">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item"><a class="nav-link active" href="#" data-index="twii">台灣市場</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link d-flex justify-content-between align-items-center group-toggle"
                                            data-bs-toggle="collapse" href="#us-market-list" role="button"
                                            aria-expanded="false" aria-controls="us-market-list" aria-label="切換美國市場群組"
                                            style="cursor:pointer;">
                                            美國市場
                                            <span class="bi bi-plus-circle"></span>
                                        </a>
                                        <div class="collapse" id="us-market-list">
                                            <ul class="nav flex-column ms-3 small">
                                                <li class="nav-item"><a class="nav-link" href="#" data-index="spx">S&P
                                                        500</a></li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="ixic">納斯達克指數</a></li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="dji">道瓊工業指數</a></li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="eur">歐洲市場</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="n225">日本市場</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex justify-content-between align-items-center fw-semibold fs-5 group-toggle text-dark"
                                data-bs-toggle="collapse" href="#global-bonds-list" role="button" aria-expanded="true"
                                aria-controls="global-bonds-list" aria-label="切換債券市場群組" style="cursor:pointer;">
                                債券市場
                                <span class="bi bi-plus-circle"></span>
                            </a>
                            <div class="collapse show" id="global-bonds-list">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link d-flex justify-content-between align-items-center group-toggle"
                                            data-bs-toggle="collapse" href="#tw-bonds-list" role="button"
                                            aria-expanded="false" aria-controls="tw-bonds-list" aria-label="切換台灣公債群組"
                                            style="cursor:pointer;">
                                            台灣公債
                                            <span class="bi bi-plus-circle"></span>
                                        </a>
                                        <div class="collapse" id="tw-bonds-list">
                                            <ul class="nav flex-column ms-3 small">
                                                <li class="nav-item">
                                                    <a class="nav-link" href="#" data-index="twb20">台灣-20年期公債殖利率</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="twb10">台灣-10年期公債殖利率</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="twb5">台灣-5年期公債殖利率</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link d-flex justify-content-between align-items-center group-toggle"
                                            data-bs-toggle="collapse" href="#us-bonds-list" role="button"
                                            aria-expanded="false" aria-controls="us-bonds-list" aria-label="切換美國公債群組"
                                            style="cursor:pointer;">
                                            美國公債
                                            <span class="bi bi-plus-circle"></span>
                                        </a>
                                        <div class="collapse" id="us-bonds-list">
                                            <ul class="nav flex-column ms-3 small">
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="usb20">美國-20年期公債殖利率</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="usb10">美國-10年期公債殖利率</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="usb2">美國-2年期公債殖利率</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link d-flex justify-content-between align-items-center group-toggle"
                                            data-bs-toggle="collapse" href="#jp-bonds-list" role="button"
                                            aria-expanded="false" aria-controls="jp-bonds-list" aria-label="切換日本公債群組"
                                            style="cursor:pointer;">
                                            日本公債
                                            <span class="bi bi-plus-circle"></span>
                                        </a>
                                        <div class="collapse" id="jp-bonds-list">
                                            <ul class="nav flex-column ms-3 small">
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="jpb30">日本-30年期公債殖利率</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="jpb10">日本-10年期公債殖利率</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="jpb2">日本-2年期公債殖利率</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>


                                </ul>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex justify-content-between align-items-center fw-semibold fs-5 group-toggle text-dark"
                                data-bs-toggle="collapse" href="#fx-list" role="button" aria-expanded="true"
                                aria-controls="fx-list" aria-label="切換匯市群組" style="cursor:pointer;">
                                匯市
                                <span class="bi bi-plus-circle"></span>
                            </a>
                            <div class="collapse show" id="fx-list">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link d-flex justify-content-between align-items-center group-toggle"
                                            data-bs-toggle="collapse" href="#to-twd-list" role="button"
                                            aria-expanded="false" aria-controls="to-twd-list" aria-label="切換外幣兌台幣群組"
                                            style="cursor:pointer;">外幣兌台幣
                                            <span class="bi bi-plus-circle"></span>
                                        </a>

                                        <div class="collapse" id="to-twd-list">
                                            <ul class="nav flex-column ms-3 small">
                                                <li class="nav-item">
                                                    <a class="nav-link" href="#" data-index="usd_twd">美元/台幣</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="jpy_twd">日圓/台幣</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="eur_twd">歐元/台幣</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="hkd_twd">港幣/台幣</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="krw_twd">韓元/台幣</a>
                                                </li>
                                                <li class="nav-item"><a class="nav-link" href="#"
                                                        data-index="cny_twd">人民幣/台幣</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>

                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </aside>

            <!-- Offcanvas for 小螢幕 -->
            <aside class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="sidebarOffcanvas"
                aria-labelledby="sidebarOffcanvasLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title fs-3" id="sidebarOffcanvasLabel">功能選單</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                </div>
                <div class="offcanvas-body p-0">
                    <ul class="nav flex-column" id="index-list-offcanvas">
                        <!-- 由 JS 動態產生內容 -->
                    </ul>
                </div>
            </aside>

            <!-- 主內容 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

                <div
                    class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">市場指數</h1>
                </div>
                <h2 class="h4" id="chart-title">台灣加權指數</h2>
                <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>

                <!-- 股票表格區塊（預設顯示） -->
                <h2 class="mt-4 mb-3" id="section-title">台灣市場主要股票</h2>
                <div class="table-responsive mb-4" id="stock-table-wrap">
                    <table class="table table-striped align-middle" id="stock-table" aria-label="股票表格">
                        <thead>
                            <tr>
                                <th scope="col">證券代碼</th>
                                <th scope="col">證券名稱</th>
                                <th scope="col">收盤指數</th>
                                <th scope="col">漲跌幅</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 由 JS 動態產生主要股票內容 -->
                        </tbody>
                    </table>
                </div>

                <!-- 債券表格區塊（預設隱藏，JS 切換顯示） -->
                <div class="table-responsive mb-4 d-none" id="bond-table-wrap">
                    <table class="table table-striped align-middle" id="bond-table" aria-label="債券表格">
                        <thead>
                            <tr>
                                <th scope="col">年期</th>
                                <th scope="col">名稱</th>
                                <th scope="col">殖利率</th>
                                <th scope="col">漲跌幅</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 由 JS 動態產生債券內容 -->
                        </tbody>
                    </table>
                </div>

                <!-- 匯市表格區塊（預設隱藏，JS 切換顯示） -->
                <div class="table-responsive mb-4 d-none" id="fx-table-wrap">
                    <table class="table table-striped align-middle" id="fx-table" aria-label="匯市表格">
                        <thead>
                            <tr>
                                <th scope="col">日期</th>
                                <th scope="col">幣別</th>
                                <th scope="col">即期匯率(買入)</th>
                                <th scope="col">即期匯率(賣出)</th>
                                <th scope="col">現金匯率(買入)</th>
                                <th scope="col">現金匯率(賣出)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 由 JS 動態產生匯市內容 -->
                        </tbody>
                    </table>
                </div>

            </main>
        </div>
    </div>





    <footer class="p-2 text-bg-dark">
        <p class="text-center fs-5">財經資訊網站</p>
    </footer>

    <!-- 登入 Modal -->
    <div class="modal modal-sheet fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-4 shadow">
                <div class="modal-header p-5 pb-4 border-bottom-0">
                    <div class="d-flex w-100 align-items-center justify-content-center position-relative">
                        <h1 class="fw-bold mb-0 fs-2" id="loginModalLabel">登入</h1>
                        <button type="button" class="btn-close position-absolute end-0" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body p-5 pt-0">
                    <form>
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control rounded-3" id="loginEmail"
                                placeholder="name@example.com">
                            <label for="loginEmail">電子郵件</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control rounded-3" id="loginPassword"
                                placeholder="請輸入密碼">
                            <label for="loginPassword">密碼</label>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="showLoginPassword">
                                <label class="form-check-label" for="showLoginPassword">顯示密碼</label>
                            </div>
                        </div>
                        <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit">登入</button>
                        <small class="d-flex text-body-secondary justify-content-center">登入即表示同意本站使用條款。</small>
                        <hr class="my-4" />
                        <h2 class="fs-5 fw-bold mb-3 d-flex justify-content-center">或使用第三方登入</h2>
                        <a href="https://www.google.com/" target="_blank" rel="noopener">
                            <button class="w-100 py-2 mb-2 btn btn-outline-secondary rounded-3" type="button">
                                <i class="bi bi-google me-1"></i> Google 登入
                            </button>
                        </a>
                        <a href="https://www.facebook.com/" target="_blank" rel="noopener">
                            <button class="w-100 py-2 mb-2 btn btn-outline-primary rounded-3" type="button">
                                <i class="bi bi-facebook me-1"></i> Facebook 登入
                            </button>
                        </a>
                        <a href="https://github.com/" target="_blank" rel="noopener">
                            <button class="w-100 py-2 mb-2 btn btn-outline-secondary rounded-3" type="button">
                                <i class="bi bi-github me-1"></i> GitHub 登入
                            </button>
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 註冊 Modal -->
    <div class="modal modal-sheet fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-4 shadow">
                <div class="modal-header p-5 pb-4 border-bottom-0">
                    <div class="d-flex w-100 align-items-center justify-content-center position-relative">
                        <h1 class="fw-bold mb-0 fs-2" id="registerModalLabel">註冊會員</h1>
                        <button type="button" class="btn-close position-absolute end-0" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body p-5 pt-0">
                    <form>
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control rounded-3" id="registerEmail"
                                placeholder="name@example.com">
                            <label for="registerEmail">電子郵件</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control rounded-3" id="registerPassword"
                                placeholder="請輸入密碼">
                            <label for="registerPassword">密碼</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control rounded-3" id="registerPassword2"
                                placeholder="請再次輸入密碼">
                            <label for="registerPassword2">確認密碼</label>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="showRegisterPassword">
                                <label class="form-check-label" for="showRegisterPassword">顯示密碼</label>
                            </div>
                        </div>
                        <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit">註冊</button>
                        <small class="text-body-secondary d-flex justify-content-center">註冊即表示同意本站使用條款。</small>
                        <hr class="my-4" />
                        <h2 class="fs-5 fw-bold mb-3 d-flex justify-content-center">或使用第三方登入</h2>
                        <a href="https://www.google.com/" target="_blank" rel="noopener">
                            <button class="w-100 py-2 mb-2 btn btn-outline-secondary rounded-3" type="button">
                                <i class="bi bi-google me-1"></i> Google 登入
                            </button>
                        </a>
                        <a href="https://www.facebook.com/" target="_blank" rel="noopener">
                            <button class="w-100 py-2 mb-2 btn btn-outline-primary rounded-3" type="button">
                                <i class="bi bi-facebook me-1"></i> Facebook 登入
                            </button>
                        </a>
                        <a href="https://github.com/" target="_blank" rel="noopener">
                            <button class="w-100 py-2 mb-2 btn btn-outline-secondary rounded-3" type="button">
                                <i class="bi bi-github me-1"></i> GitHub 登入
                            </button>
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.2/dist/chart.umd.js"></script>
    <script src="./bootstrap-5.3.8-dist/js/bootstrap.bundle.min.js"></script>
    <script src="./SP_js/login_register.js"></script>
    <script>
        // 主內容互動邏輯
        document.addEventListener('DOMContentLoaded', function () {

            const chartTitle = document.getElementById('chart-title');
            const ctx = document.getElementById('myChart').getContext('2d');
            const sectionTitle = document.getElementById('section-title');
            const stockTableWrap = document.getElementById('stock-table-wrap');
            const bondTableWrap = document.getElementById('bond-table-wrap');
            const fxTableWrap = document.getElementById('fx-table-wrap');
            const stockTableBody = document.querySelector('#stock-table tbody');
            const bondTableBody = document.querySelector('#bond-table tbody');
            const fxTableBody = document.querySelector('#fx-table tbody');

            // 控制側邊欄 collapse 圖示 +/− 切換（點擊立即切換，動畫結束再同步）
            function updateCollapseIcons() {
                document.querySelectorAll('.group-toggle').forEach(function (toggle) {
                    let icon = toggle.querySelector('.bi');
                    let collapseTarget = document.querySelector(toggle.getAttribute('href'));
                    if (!collapseTarget || !icon) return;
                    if (collapseTarget.classList.contains('show')) {
                        icon.classList.remove('bi-plus-circle');
                        icon.classList.add('bi-dash-circle');
                    } else {
                        icon.classList.remove('bi-dash-circle');
                        icon.classList.add('bi-plus-circle');
                    }
                });
            }
            // 初始狀態
            updateCollapseIcons();
            // 點擊群組時立即切換圖示
            document.querySelectorAll('.group-toggle').forEach(function (toggle) {
                toggle.addEventListener('click', function (e) {
                    let icon = toggle.querySelector('.bi');
                    let collapseTarget = document.querySelector(toggle.getAttribute('href'));
                    if (!collapseTarget || !icon) return;
                    let willShow = !collapseTarget.classList.contains('show');
                    if (willShow) {
                        icon.classList.remove('bi-plus-circle');
                        icon.classList.add('bi-dash-circle');
                    } else {
                        icon.classList.remove('bi-dash-circle');
                        icon.classList.add('bi-plus-circle');
                    }
                });
            });
            // 監聽所有 collapse 展開/收合事件（事件冒泡，動畫結束再同步）
            document.getElementById('index-list').addEventListener('shown.bs.collapse', updateCollapseIcons);
            document.getElementById('index-list').addEventListener('hidden.bs.collapse', updateCollapseIcons);
            // 讓 offcanvas 側邊欄 collapse 也能同步圖示
            document.getElementById('index-list-offcanvas').addEventListener('shown.bs.collapse', updateCollapseIcons);
            document.getElementById('index-list-offcanvas').addEventListener('hidden.bs.collapse', updateCollapseIcons);


            // 產生近6日日期陣列（全域共用）
            window.getRecentDates = function (n) {
                const arr = [];
                const today = new Date();
                for (let i = n - 1; i >= 0; i--) {
                    const d = new Date(today);
                    d.setDate(today.getDate() - i);
                    arr.push(d.toISOString().slice(0, 10));
                }
                return arr;
            };
            const dateLabels = window.getRecentDates(6);


            // 指數、債券、匯市圖表資料（共用 dateLabels）
            const indexData = {
                // 股市指數（模擬資料）
                twii: {
                    title: '台灣加權指數',
                    label: '加權指數',
                    labels: dateLabels,
                    data: [27980, 28303, 28182, 28400, 28024, 28198],
                    color: '#007bff'
                },
                dji: {
                    title: '道瓊工業指數',
                    label: 'Dow Jones',
                    labels: dateLabels,
                    data: [47954, 47739, 47560, 48057, 48704, 48458],
                    color: '#28a745'
                },
                spx: {
                    title: 'S&P 500 指數',
                    label: 'S&P 500',
                    labels: dateLabels,
                    data: [6870, 6846, 6840, 6886, 6901, 6827],
                    color: '#dc3545'
                },
                ixic: {
                    title: 'NASDAQ 指數',
                    label: 'NASDAQ',
                    labels: dateLabels,
                    data: [23578, 23545, 23576, 23654, 23593, 23195],
                    color: '#fd7e14'
                },
                n225: {
                    title: '日經225指數',
                    label: 'Nikkei 225',
                    labels: dateLabels,
                    data: [50491, 50581, 50655, 50602, 50148, 50836],
                    color: '#6f42c1'
                },
                eur: {
                    title: 'Euro Stoxx 50指數',
                    label: 'Euro Stoxx 50',
                    labels: dateLabels,
                    data: [5723, 5725, 5718, 5708, 5753, 5720],
                    color: '#20c997'
                },
                // 債券殖利率（模擬資料）
                twb20: {
                    title: '台灣-20年期公債殖利率',
                    label: '20年期殖利率',
                    labels: dateLabels,
                    data: [1.35, 1.36, 1.37, 1.38, 1.36, 1.37],
                    color: '#0d6efd'
                },
                twb10: {
                    title: '台灣-10年期公債殖利率',
                    label: '10年期殖利率',
                    labels: dateLabels,
                    data: [1.12, 1.13, 1.14, 1.13, 1.12, 1.13],
                    color: '#6610f2'
                },
                twb5: {
                    title: '台灣-5年期公債殖利率',
                    label: '5年期殖利率',
                    labels: dateLabels,
                    data: [0.98, 0.99, 1.00, 0.99, 0.98, 0.99],
                    color: '#20c997'
                },
                usb20: {
                    title: '美國-20年期公債殖利率',
                    label: '20年期殖利率',
                    labels: dateLabels,
                    data: [4.35, 4.36, 4.37, 4.38, 4.36, 4.37],
                    color: '#fd7e14'
                },
                usb10: {
                    title: '美國-10年期公債殖利率',
                    label: '10年期殖利率',
                    labels: dateLabels,
                    data: [4.12, 4.13, 4.14, 4.13, 4.12, 4.13],
                    color: '#dc3545'
                },
                usb2: {
                    title: '美國-2年期公債殖利率',
                    label: '2年期殖利率',
                    labels: dateLabels,
                    data: [4.98, 4.99, 5.00, 4.99, 4.98, 4.99],
                    color: '#198754'
                },
                jpb30: {
                    title: '日本-30年期公債殖利率',
                    label: '30年期殖利率',
                    labels: dateLabels,
                    data: [3.30, 3.31, 3.32, 3.33, 3.31, 3.32],
                    color: '#ffc107'
                },
                jpb10: {
                    title: '日本-10年期公債殖利率',
                    label: '10年期殖利率',
                    labels: dateLabels,
                    data: [1.90, 1.91, 1.92, 1.93, 1.91, 1.92],
                    color: '#fd7e14'
                },
                jpb2: {
                    title: '日本-2年期公債殖利率',
                    label: '2年期殖利率',
                    labels: dateLabels,
                    data: [0.50, 0.51, 0.52, 0.53, 0.51, 0.52],
                    color: '#0d6efd'
                },
                // 匯市資料（模擬資料）
                usd_twd: {
                    title: '美元/台幣即期匯率',
                    labels: dateLabels,
                    buy: [31.142, 31.158, 31.148, 31.223, 31.138, 31.138],
                    sell: [31.242, 31.258, 31.248, 31.323, 31.238, 31.238],
                    buyLabel: '銀行即期買入',
                    sellLabel: '銀行即期賣出',
                    buyColor: '#ff0000',
                    sellColor: '#0000ff'
                },
                jpy_twd: {
                    title: '日圓/台幣即期匯率',
                    labels: dateLabels,
                    buy: [0.1987, 0.1978, 0.1972, 0.1984, 0.1983, 0.1983],
                    sell: [0.2027, 0.2018, 0.2012, 0.2024, 0.2023, 0.2023],
                    buyLabel: '銀行即期買入',
                    sellLabel: '銀行即期賣出',
                    buyColor: '#ff0000',
                    sellColor: '#0000ff'
                },
                eur_twd: {
                    title: '歐元/台幣即期匯率',
                    labels: dateLabels,
                    buy: [34.12, 34.10, 34.08, 34.05, 34.03, 33.98],
                    sell: [34.22, 34.20, 34.18, 34.15, 34.13, 34.08],
                    buyLabel: '銀行即期買入',
                    sellLabel: '銀行即期賣出',
                    buyColor: '#ff0000',
                    sellColor: '#0000ff'
                },
                hkd_twd: {
                    title: '港幣/台幣即期匯率',
                    labels: dateLabels,
                    buy: [3.99, 3.98, 3.97, 3.96, 3.95, 3.94],
                    sell: [4.01, 4.00, 3.99, 3.98, 3.97, 3.96],
                    buyLabel: '銀行即期買入',
                    sellLabel: '銀行即期賣出',
                    buyColor: '#ff0000',
                    sellColor: '#0000ff'
                },
                krw_twd: {
                    title: '韓元/台幣即期匯率',
                    labels: dateLabels,
                    buy: [0.0223, 0.0229, 0.0228, 0.0227, 0.0226, 0.0227],
                    sell: [0.0225, 0.0231, 0.0230, 0.0229, 0.0228, 0.0228],
                    buyLabel: '銀行即期買入',
                    sellLabel: '銀行即期賣出',
                    buyColor: '#ff0000',
                    sellColor: '#0000ff'
                },
                cny_twd: {
                    title: '人民幣/台幣即期匯率',
                    labels: dateLabels,
                    buy: [4.3877, 4.3897, 4.3943, 4.4054, 4.3966, 4.3966],
                    sell: [4.4357, 4.4377, 4.4423, 4.4534, 4.4446, 4.4446],
                    buyLabel: '銀行即期買入',
                    sellLabel: '銀行即期賣出',
                    buyColor: '#ff0000',
                    sellColor: '#0000ff'
                },
            };

            // 各市場靜態資料（主要股票、債券、匯市表格資料）
            const marketTableData = {
                // 股票表格資料（模擬資料）
                twii: [
                    ['^TWII', '台灣加權指數', 28198.00, 0.7],
                    ['2330', '台積電', 620.00, 1.2],
                    ['2317', '鴻海', 110.50, -0.8],
                    ['2308', '台達電', 320.00, 0.5],
                    ['2454', '聯發科', 1100.00, 2.1],
                    ['2881', '富邦金', 70.20, -0.3],
                    ['2382', '廣達', 220.00, 0.9],
                    ['3711', '日月光投控', 120.00, 0.4],
                    ['2412', '中華電', 120.50, -0.2],
                    ['2882', '國泰金', 55.80, 0.6],
                    ['2891', '中信金', 25.10, 0.3],
                ],
                n225: [
                    ['^N225', '日經225指數', 50836.00, 0.9],
                    ['7203', '豐田汽車', 2700.00, 1.1],
                    ['6758', '索尼', 13000.00, -0.5],
                    ['9984', '軟銀集團', 6500.00, 2.3],
                    ['8306', '三菱UFJ', 1200.00, 0.7],
                    ['9432', '日本電信電話', 170.00, -0.2],
                    ['7267', '本田', 4000.00, 0.9],
                    ['6861', '鍵山製作所', 7000.00, -1.0],
                    ['8035', '東京電子', 25000.00, 1.8],
                    ['4063', '信越化學', 6000.00, 0.4],
                    ['6098', 'Recruit', 5000.00, -0.3],
                ],
                spx: [
                    ['^SPX', '標普500指數', 6827.00, -0.5],
                    ['AAPL', 'Apple', 195.00, 1.5],
                    ['MSFT', 'Microsoft', 410.00, 0.8],
                    ['AMZN', 'Amazon', 170.00, -0.6],
                    ['GOOGL', 'Alphabet', 135.00, 2.2],
                    ['META', 'Meta', 320.00, 1.1],
                    ['BRK.B', 'Berkshire Hathaway', 410.00, -0.2],
                    ['NVDA', 'NVIDIA', 650.00, 3.0],
                    ['JPM', 'JPMorgan Chase', 160.00, 0.4],
                    ['V', 'Visa', 250.00, 0.7],
                    ['TSLA', 'Tesla', 250.00, -1.3],
                ],
                dji: [
                    ['^DJI', '道瓊工業指數', 48458.00, -0.2],
                    ['UNH', 'UnitedHealth', 520.00, 0.9],
                    ['GS', 'Goldman Sachs', 390.00, -0.4],
                    ['HD', 'Home Depot', 350.00, 1.2],
                    ['MSFT', 'Microsoft', 410.00, 0.8],
                    ['AAPL', 'Apple', 195.00, 1.5],
                    ['V', 'Visa', 250.00, 0.7],
                    ['JNJ', 'Johnson & Johnson', 160.00, -0.2],
                    ['PG', 'Procter & Gamble', 150.00, 0.3],
                    ['TRV', 'Travelers', 180.00, -0.5],
                    ['IBM', 'IBM', 170.00, 0.6],
                ],
                ixic: [
                    ['^IXIC', '納斯達克指數', 23195.00, -1.7],
                    ['AAPL', 'Apple', 195.00, 1.5],
                    ['MSFT', 'Microsoft', 410.00, 0.8],
                    ['AMZN', 'Amazon', 170.00, -0.6],
                    ['GOOGL', 'Alphabet', 135.00, 2.2],
                    ['META', 'Meta', 320.00, 1.1],
                    ['NVDA', 'NVIDIA', 650.00, 3.0],
                    ['TSLA', 'Tesla', 250.00, -1.3],
                    ['AVGO', 'Broadcom', 1200.00, 0.9],
                    ['ADBE', 'Adobe', 600.00, 0.5],
                    ['PEP', 'PepsiCo', 180.00, -0.2],
                ],
                eur: [
                    ['^STOXX50E', 'Euro Stoxx 50指數', 5720.00, -0.6],
                    ['SAP', 'SAP SE', 130.00, 1.0],
                    ['ASML', 'ASML Holding', 700.00, -0.7],
                    ['SAN', 'Sanofi', 90.00, 0.4],
                    ['OR', 'L\'Oreal', 400.00, 1.8],
                    ['RMS', 'Roche', 300.00, -0.3],
                    ['SIE', 'Siemens', 140.00, 0.6],
                    ['BAS', 'BASF', 60.00, -1.1],
                    ['DTE', 'Deutsche Telekom', 20.00, 0.2],
                    ['VOW3', 'Volkswagen', 200.00, 0.9],
                    ['ALV', 'Allianz', 220.00, -0.4],
                ],
                // 債券表格資料（模擬資料）
                twb: [
                    ['30年期', '台灣-30年期公債殖利率', 1.54, 0.00],
                    ['20年期', '台灣-20年期公債殖利率', 1.37, 0.01],
                    ['10年期', '台灣-10年期公債殖利率', 1.13, -0.02],
                    ['5年期', '台灣-5年期公債殖利率', 0.99, 0.00],
                ],
                usb: [
                    ['30年期', '美國-30年期公債殖利率', 4.86, 0.07],
                    ['20年期', '美國-20年期公債殖利率', 4.82, 0.06],
                    ['10年期', '美國-10年期公債殖利率', 4.2, 0.06],
                    ['5年期', '美國-5年期公債殖利率', 3.75, 0.03],
                    ['3年期', '美國-3年期公債殖利率', 3.59, 0.02],
                    ['2年期', '美國-2年期公債殖利率', 3.53, 0.00],
                    ['1年期', '美國-1年期公債殖利率', 3.53, -0.02],
                    ['6個月期', '美國-6個月期公債殖利率', 3.59, -0.04],
                    ['3個月期', '美國-3個月期公債殖利率', 3.62, -0.04],
                ],
                jpb: [
                    ['30年期', '日本-30年期公債殖利率', 3.36, 0.00],
                    ['10年期', '日本-10年期公債殖利率', 1.95, 0.02],
                    ['2年期', '日本-2年期公債殖利率', 1.07, 0.01],
                    ['3個月期', '日本-3個月期公債殖利率', 0.65, 0.01],
                ],

                // 匯市表格資料（即期/現金匯率）
                usd_twd: null, // 先設null，稍後初始化
                jpy_twd: null,
                eur_twd: null,
                hkd_twd: null,
                krw_twd: null,
                cny_twd: null,
            };
            // 匯市資料自動日期產生共用函式（全域工具）
            function genFxRows(currency, spotBuyArr, spotSellArr, cashBuyArr, cashSellArr) {
                const today = new Date();
                function getDateStr(offset) {
                    const d = new Date(today);
                    d.setDate(today.getDate() - offset);
                    return d.toISOString().slice(0, 10);
                }
                const rows = [];
                for (let i = 0; i < 6; i++) {
                    rows.push({
                        date: getDateStr(i),
                        currency,
                        spotBuy: spotBuyArr[i],
                        spotSell: spotSellArr[i],
                        cashBuy: cashBuyArr[i],
                        cashSell: cashSellArr[i]
                    });
                }
                return rows;
            }
            marketTableData.usd_twd = genFxRows(
                'USD/TWD',
                [31.138, 31.138, 31.223, 31.148, 31.158, 31.142],
                [31.238, 31.238, 31.323, 31.248, 31.258, 31.242],
                [31.01, 30.98, 30.95, 30.93, 30.90, 30.88],
                [30.91, 30.88, 30.85, 30.83, 30.80, 30.78]
            );
            marketTableData.jpy_twd = genFxRows(
                'JPY/TWD',
                [0.1983, 0.1983, 0.1984, 0.1972, 0.1978, 0.1979],
                [0.2023, 0.2023, 0.2024, 0.2012, 0.2018, 0.2019],
                [0.232, 0.231, 0.230, 0.229, 0.228, 0.227],
                [0.238, 0.237, 0.236, 0.235, 0.234, 0.233]
            );
            marketTableData.eur_twd = genFxRows(
                'EUR/TWD',
                [33.98, 34.03, 34.05, 34.08, 34.10, 34.12],
                [34.08, 34.13, 34.15, 34.18, 34.20, 34.22],
                [33.90, 33.88, 33.86, 33.83, 33.81, 33.76],
                [34.30, 34.28, 34.26, 34.23, 34.21, 34.16]
            );
            marketTableData.hkd_twd = genFxRows(
                'HKD/TWD',
                [3.94, 3.95, 3.96, 3.97, 3.99, 3.99],
                [3.96, 3.97, 3.98, 3.99, 4.01, 4.01],
                [3.97, 3.96, 3.95, 3.94, 3.93, 3.92],
                [4.03, 4.02, 4.01, 4.00, 3.99, 3.98]
            );
            marketTableData.krw_twd = genFxRows(
                'KRW/TWD',
                [0.0227, 0.0226, 0.0227, 0.0228, 0.0229, 0.023],
                [0.0228, 0.0228, 0.0229, 0.0230, 0.0231, 0.0232],
                [0.0228, 0.0227, 0.0226, 0.0225, 0.0224, 0.0223],
                [0.0234, 0.0233, 0.0232, 0.0231, 0.0230, 0.0229]
            );
            marketTableData.cny_twd = genFxRows(
                'CNY/TWD',
                [4.3966, 4.3966, 4.4054, 4.3943, 4.3897, 4.3877],
                [4.4446, 4.4446, 4.4534, 4.4423, 4.4377, 4.4357],
                [4.33, 4.32, 4.31, 4.30, 4.29, 4.28],
                [4.39, 4.38, 4.37, 4.36, 4.35, 4.34]
            );


            // 初始化圖表
            let chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: indexData.twii.labels,
                    datasets: [{
                        label: indexData.twii.label,
                        data: indexData.twii.data,
                        borderColor: indexData.twii.color,
                        backgroundColor: 'rgba(0,123,255,0.1)',
                        tension: 0.3,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: true } },
                    scales: { y: { beginAtZero: false } }
                }
            });

            // 更新圖表資料
            // 產生匯市表格內容（靜態資料）
            function renderFxTable(market) {
                const data = marketTableData[market] || [];
                let html = '';
                data.forEach(row => {
                    html += `<tr>
                        <td>${row.date}</td>
                        <td>${row.currency}</td>
                        <td>${row.spotBuy}</td>
                        <td>${row.spotSell}</td>
                        <td>${row.cashBuy}</td>
                        <td>${row.cashSell}</td>
                    </tr>`;
                });
                fxTableBody.innerHTML = html;
            }

            // 產生表格內容
            function renderMarketTable(market) {
                // 匯市表格特殊處理
                if (["usd_twd", "jpy_twd", "eur_twd", "hkd_twd", "krw_twd", "cny_twd"].includes(market)) {
                    stockTableWrap.classList.add('d-none');
                    bondTableWrap.classList.add('d-none');
                    fxTableWrap.classList.remove('d-none');
                    renderFxTable(market);
                    return;
                }
                const data = marketTableData[market] || [];
                if (market === 'twb' || market === 'usb' || market === 'jpb') {
                    // 顯示債券表格，隱藏股票表格、匯市表格
                    stockTableWrap.classList.add('d-none');
                    bondTableWrap.classList.remove('d-none');
                    fxTableWrap.classList.add('d-none');
                    let html = '';
                    data.forEach(row => {
                        const [term, name, rate, change] = row;
                        let changeCell = '';
                        if (typeof change === 'number') {
                            const up = change > 0;
                            const cls = up ? 'text-danger' : (change < 0 ? 'text-success' : '');
                            const icon = up ? 'bi-caret-up-fill' : (change < 0 ? 'bi-caret-down-fill' : '');
                            const sign = up ? '+' : '';
                            changeCell = `<td class="${cls}">${icon ? `<i class='bi ${icon}'></i>` : ''} ${sign}${change}%</td>`;
                        } else {
                            changeCell = '<td></td>';
                        }
                        html += `<tr><td>${term}</td><td>${name}</td><td>${rate}%</td>${changeCell}</tr>`;
                    });
                    bondTableBody.innerHTML = html;
                } else {
                    // 顯示股票表格，隱藏債券表格、匯市表格
                    bondTableWrap.classList.add('d-none');
                    stockTableWrap.classList.remove('d-none');
                    fxTableWrap.classList.add('d-none');
                    let html = '';
                    data.forEach(row => {
                        const [code, name, price, change] = row;
                        const up = change > 0;
                        const cls = up ? 'text-danger' : 'text-success';
                        const icon = up ? 'bi-caret-up-fill' : 'bi-caret-down-fill';
                        const sign = up ? '+' : '';
                        html += `<tr><td>${code}</td><td>${name}</td><td>${price.toLocaleString()}</td><td class="${cls}"><i class="bi ${icon}"></i> ${sign}${change}%</td></tr>`;
                    });
                    stockTableBody.innerHTML = html;
                }
            }


            // 預設載入台灣市場
            renderMarketTable('twii');

            // 動態產生 offcanvas 側邊欄內容
            (function generateOffcanvasSidebar() {
                const staticList = document.getElementById('index-list');
                const offcanvasList = document.getElementById('index-list-offcanvas');
                if (!staticList || !offcanvasList) return;
                // 複製靜態側邊欄內容
                let html = staticList.innerHTML;
                // 將所有 id="xxx-list" 替換為 id="offcanvas-xxx-list"
                html = html.replace(/id="(\w+-market-list|\w+-bonds-list|\w+-list|tw-bonds-list|us-bonds-list|jp-bonds-list|to-twd-list)"/g, function (match, p1) {
                    return 'id="offcanvas-' + p1 + '"';
                });
                // 將所有 href="#xxx-list" 替換為 href="#offcanvas-xxx-list"
                html = html.replace(/href="#(\w+-market-list|\w+-bonds-list|\w+-list|tw-bonds-list|us-bonds-list|jp-bonds-list|to-twd-list)"/g, function (match, p1) {
                    return 'href="#offcanvas-' + p1 + '"';
                });
                // aria-controls="xxx-list" -> aria-controls="offcanvas-xxx-list"
                html = html.replace(/aria-controls="(\w+-market-list|\w+-bonds-list|\w+-list|tw-bonds-list|us-bonds-list|jp-bonds-list|to-twd-list)"/g, function (match, p1) {
                    return 'aria-controls="offcanvas-' + p1 + '"';
                });
                // 填入 offcanvas 側邊欄
                offcanvasList.innerHTML = html;
            })();


            // 側邊欄切換（股票/債券/匯市）for 靜態側邊欄與 offcanvas
            function handleSidebarClick(e, listSelector) {
                if (e.target.tagName === 'A' && e.target.dataset.index !== undefined) {
                    e.preventDefault();
                    // 切換 active 樣式（只針對當前側邊欄）
                    document.querySelectorAll(listSelector + ' .nav-link').forEach(link => link.classList.remove('active'));
                    e.target.classList.add('active');
                    const idx = e.target.dataset.index;
                    // 股票/債券/匯市
                    if (indexData[idx]) {
                        const d = indexData[idx];
                        // 匯市 chart 雙線圖表
                        if (["usd_twd", "jpy_twd", "eur_twd", "hkd_twd", "krw_twd", "cny_twd"].includes(idx)) {
                            chartTitle.textContent = d.title;
                            chart.data.labels = d.labels;
                            chart.data.datasets = [
                                {
                                    label: d.sellLabel,
                                    data: d.sell,
                                    borderColor: d.sellColor,
                                    backgroundColor: 'rgba(0,0,255,0.05)',
                                    tension: 0.3,
                                    fill: false,
                                },
                                {
                                    label: d.buyLabel,
                                    data: d.buy,
                                    borderColor: d.buyColor,
                                    backgroundColor: 'rgba(255,0,0,0.05)',
                                    tension: 0.3,
                                    fill: false,
                                }
                            ];
                            chart.options.plugins.legend.display = true;
                            chart.update();
                            let fxTitleMap = {
                                usd_twd: '各天期美元/台幣即期匯率',
                                jpy_twd: '各天期日圓/台幣即期匯率',
                                eur_twd: '各天期歐元/台幣即期匯率',
                                hkd_twd: '各天期港幣/台幣即期匯率',
                                krw_twd: '各天期韓元/台幣即期匯率',
                                cny_twd: '各天期人民幣/台幣即期匯率'
                            };
                            sectionTitle.textContent = fxTitleMap[idx] || (d.title + '即期匯率');
                            renderMarketTable(idx);
                        } else {
                            // 其他市場維持原本單線圖表
                            chartTitle.textContent = d.title;
                            chart.data.labels = d.labels;
                            chart.data.datasets = [{
                                label: d.label,
                                data: d.data,
                                borderColor: d.color,
                                backgroundColor: d.color + '22',
                                tension: 0.3,
                                fill: true,
                            }];
                            chart.options.plugins.legend.display = true;
                            chart.update();
                            const marketNames = {
                                twii: '台灣市場',
                                n225: '日本市場',
                                spx: 'S&P 500',
                                dji: '道瓊工業',
                                ixic: '納斯達克',
                                eur: '歐洲市場',
                                twb: '台灣公債',
                                usb: '美國公債',
                                jpb: '日本公債',
                                twb20: '台灣20年期',
                                twb10: '台灣10年期',
                                twb5: '台灣5年期',
                                usb20: '美國20年期',
                                usb10: '美國10年期',
                                usb2: '美國2年期'
                            };
                            // 若是債券年期，section-title 統一顯示各年期殖利率，並顯示債券表格
                            if (['twb20', 'twb10', 'twb5'].includes(idx)) {
                                sectionTitle.textContent = '台灣公債各年期殖利率';
                                renderMarketTable('twb');
                            } else if (['usb20', 'usb10', 'usb2'].includes(idx)) {
                                sectionTitle.textContent = '美國公債各年期殖利率';
                                renderMarketTable('usb');
                            } else if (['jpb30', 'jpb10', 'jpb2'].includes(idx)) {
                                sectionTitle.textContent = '日本公債各年期殖利率';
                                renderMarketTable('jpb');
                            }
                            else if (idx === 'twb' || idx === 'usb' || idx === 'jpb') {
                                sectionTitle.textContent = (marketNames[idx] || d.title) + '各年期殖利率';
                                renderMarketTable(idx);
                            } else {
                                sectionTitle.textContent = (marketNames[idx] || d.title) + '主要股票';
                                renderMarketTable(idx);
                            }
                        }
                    }
                }
            }
            document.getElementById('index-list').addEventListener('click', function (e) { handleSidebarClick(e, '#index-list'); });
            document.getElementById('index-list-offcanvas').addEventListener('click', function (e) { handleSidebarClick(e, '#index-list-offcanvas'); });
            // ...可擴充API串接等
        });
    </script>
</body>

</html>