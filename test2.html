<!doctype html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>test</title>
    <link rel="stylesheet" href="./bootstrap-icons-1.13.1/bootstrap-icons.css">
    <link rel="stylesheet" href="./bootstrap-5.3.8-dist/css/bootstrap.css">
    <link rel="stylesheet" href="./bootstrap-5.3.8-examples/modals/modals.css">
    <link rel="stylesheet" href="./SP_css/BS_SP_header.css">


    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .b-example-divider {
            width: 100%;
            height: 3rem;
            background-color: #0000001a;
            border: solid rgba(0, 0, 0, 0.15);
            border-width: 1px 0;
            box-shadow:
                inset 0 0.5em 1.5em #0000001a,
                inset 0 0.125em 0.5em #00000026;
        }

        .b-example-vr {
            flex-shrink: 0;
            width: 1.5rem;
            height: 100vh;
        }

        .bi {
            vertical-align: -0.125em;
            fill: currentColor;
        }

        .nav-scroller {
            position: relative;
            z-index: 2;
            height: 2.75rem;
            overflow-y: hidden;
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .btn-bd-primary {
            --bd-violet-bg: #712cf9;
            --bd-violet-rgb: 112.520718, 44.062154, 249.437846;
            --bs-btn-font-weight: 600;
            --bs-btn-color: var(--bs-white);
            --bs-btn-bg: var(--bd-violet-bg);
            --bs-btn-border-color: var(--bd-violet-bg);
            --bs-btn-hover-color: var(--bs-white);
            --bs-btn-hover-bg: #6528e0;
            --bs-btn-hover-border-color: #6528e0;
            --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
            --bs-btn-active-color: var(--bs-btn-hover-color);
            --bs-btn-active-bg: #5a23c8;
            --bs-btn-active-border-color: #5a23c8;
        }

        .bd-mode-toggle {
            z-index: 1500;
        }

        .bd-mode-toggle .bi {
            width: 1em;
            height: 1em;
        }

        .bd-mode-toggle .dropdown-menu .active .bi {
            display: block !important;
        }
    </style>
</head>

<body>

<header class="sticky-top">
    <nav class="p-2 navbar navbar-expand-lg navbar-dark bg-dark" aria-label="主導覽列">
      <div class="container">

        <a class="navbar-brand fs-3 mx-lg-0 me-lg-4 text-decoration-none text-white" href="./SP_ver_1.html">財經網</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
          aria-controls="mainNavbar" aria-expanded="false" aria-label="切換選單">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNavbar">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li><a href="./SP_ver_1.html" class="nav-link px-2 text-white">首頁</a></li>
            <li><a href="#" class="nav-link px-2 text-secondary active" aria-current="page">市場指數</a></li>
            <li><a href="#" class="nav-link px-2 text-white">新聞</a></li>
            <li><a href="#" class="nav-link px-2 text-white">觀點分析</a></li>
            <li><a href="#" class="nav-link px-2 text-white">關於</a></li>
          </ul>

          <form class="d-flex align-items-center mb-3 mb-lg-0 me-lg-3" role="search">
            <input type="search" class="form-control form-control-dark text-bg-dark search_p" placeholder="搜尋..."
              aria-label="Search" />
          </form>

          <div class="d-flex flex-lg-row flex-column align-items-center">
            <button type="button" class="btn btn-outline-light w-100 w-lg-auto mb-2 mb-lg-0 me-lg-2"
              data-bs-toggle="modal" data-bs-target="#loginModal">登入</button>
            <button type="button" class="btn btn-warning w-100 w-lg-auto mb-lg-0 mb-2 text-nowrap"
              data-bs-toggle="modal" data-bs-target="#registerModal">
              註冊會員
            </button>
          </div>

        </div>
      </div>
    </nav>
  </header>

    <div class="container">
        <div class="row">
            <!-- 側邊欄 -->
            <nav class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary position-sticky" style="top:56px;">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column" id="index-list">
                        <li class="nav-item">
                            <a class="nav-link d-flex justify-content-between align-items-center 
                          fw-semibold fs-5 group-toggle text-dark" data-bs-toggle="collapse" href="#global-market-list"
                                role="button" aria-expanded="true" aria-controls="global-market-list"
                                style="cursor:pointer;">
                                全球市場
                                <span class="bi bi-plus-circle"></span>
                            </a>
                            <div class="collapse show" id="global-market-list">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item"><a class="nav-link active" href="#" data-index="twii">台灣市場</a>
                                    </li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="spx">S&P 500</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="ixic">納斯達克指數</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="dji">道瓊工業指數</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="n225">日本市場</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#" data-index="eur">歐洲市場</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- 主內容 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div
                    class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">市場指數(截至12/13)</h1>
                </div>
                <h2 class="h4" id="chart-title">台灣加權指數</h2>
                <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>

                <h2 class="mt-4 mb-3" id="section-title">台灣市場主要股票</h2>
                <div class="table-responsive mb-4">
                    <table class="table table-striped align-middle">
                        <thead>
                            <tr>
                                <th scope="col">證券代碼</th>
                                <th scope="col">證券名稱</th>
                                <th scope="col">收盤指數</th>
                                <th scope="col">漲跌幅</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 由 JS 動態產生主要股票內容 -->
                        </tbody>
                    </table>
                </div>

            </main>
        </div>
    </div>








    <script src="./bootstrap-5.3.8-dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.2/dist/chart.umd.js"></script>
    <script src="./SP_js/login_register.js"></script>
    <script>
        // 多指數切換功能 + 主要股票表格切換
        document.addEventListener('DOMContentLoaded', function () {
            const chartTitle = document.getElementById('chart-title');
            const ctx = document.getElementById('myChart').getContext('2d');
            const sectionTitle = document.getElementById('section-title');
            const tableBody = document.querySelector('table.table tbody');

            // 控制側邊欄 collapse 圖示 +/− 切換
            document.querySelectorAll('.group-toggle').forEach(function (toggle) {
                var icon = toggle.querySelector('.bi');
                var collapseTarget = document.querySelector(toggle.getAttribute('href'));
                if (!collapseTarget) return;
                // 初始狀態
                function updateIcon(isShow) {
                    if (typeof isShow === 'boolean') {
                        if (isShow) {
                            icon.classList.remove('bi-plus-circle');
                            icon.classList.add('bi-dash-circle');
                        } else {
                            icon.classList.remove('bi-dash-circle');
                            icon.classList.add('bi-plus-circle');
                        }
                    } else {
                        // fallback: 依照 class 狀態
                        if (collapseTarget.classList.contains('show')) {
                            icon.classList.remove('bi-plus-circle');
                            icon.classList.add('bi-dash-circle');
                        } else {
                            icon.classList.remove('bi-dash-circle');
                            icon.classList.add('bi-plus-circle');
                        }
                    }
                }
                // 初始
                updateIcon(collapseTarget.classList.contains('show'));
                // 監聽展開/收合事件
                collapseTarget.addEventListener('show.bs.collapse', function () { updateIcon(true); });
                collapseTarget.addEventListener('hide.bs.collapse', function () { updateIcon(false); });
            });

            // 產生近6日日期陣列
            function getRecentDates(n) {
                const arr = [];
                const today = new Date();
                for (let i = n - 1; i >= 0; i--) {
                    const d = new Date(today);
                    d.setDate(today.getDate() - i);
                    arr.push(d.toISOString().slice(0, 10));
                }
                return arr;
            }
            const dateLabels = getRecentDates(6);

            // 指數資料
            const indexData = {
                twii: {
                    title: '台灣加權指數',
                    label: '加權指數',
                    labels: dateLabels,
                    data: [27980, 28303, 28182, 28400, 28024, 28198],
                    color: '#007bff'
                },
                dji: {
                    title: '道瓊工業指數',
                    label: 'Dow Jones',
                    labels: dateLabels,
                    data: [47954, 47739, 47560, 48057, 48704, 48458],
                    color: '#28a745'
                },
                spx: {
                    title: 'S&P 500 指數',
                    label: 'S&P 500',
                    labels: dateLabels,
                    data: [6870, 6846, 6840, 6886, 6901, 6827],
                    color: '#dc3545'
                },
                ixic: {
                    title: 'NASDAQ 指數',
                    label: 'NASDAQ',
                    labels: dateLabels,
                    data: [23578, 23545, 23576, 23654, 23593, 23195],
                    color: '#fd7e14'
                },
                n225: {
                    title: '日經225指數',
                    label: 'Nikkei 225',
                    labels: dateLabels,
                    data: [50491, 50581, 50655, 50602, 50148, 50836],
                    color: '#6f42c1'
                },
                eur: {
                    title: 'Euro Stoxx 50指數',
                    label: 'Euro Stoxx 50',
                    labels: dateLabels,
                    data: [5723, 5725, 5718, 5708, 5753, 5720],
                    color: '#20c997'
                }
            };

            // 各市場主要股票靜態資料
            const stockTableData = {
                twii: [
                    ['2330', '台積電', 620.00, 1.2],
                    ['2317', '鴻海', 110.50, -0.8],
                    ['2308', '台達電', 320.00, 0.5],
                    ['2454', '聯發科', 1100.00, 2.1],
                    ['2881', '富邦金', 70.20, -0.3],
                    ['2382', '廣達', 220.00, 0.9],
                    ['3711', '日月光投控', 120.00, 0.4],
                    ['2412', '中華電', 120.50, -0.2],
                    ['2882', '國泰金', 55.80, 0.6],
                    ['2891', '中信金', 25.10, 0.3],
                ],
                n225: [
                    ['7203', '豐田汽車', 2700.00, 1.1],
                    ['6758', '索尼', 13000.00, -0.5],
                    ['9984', '軟銀集團', 6500.00, 2.3],
                    ['8306', '三菱UFJ', 1200.00, 0.7],
                    ['9432', '日本電信電話', 170.00, -0.2],
                    ['7267', '本田', 4000.00, 0.9],
                    ['6861', '鍵山製作所', 7000.00, -1.0],
                    ['8035', '東京電子', 25000.00, 1.8],
                    ['4063', '信越化學', 6000.00, 0.4],
                    ['6098', 'Recruit', 5000.00, -0.3],
                ],
                spx: [
                    ['AAPL', 'Apple', 195.00, 1.5],
                    ['MSFT', 'Microsoft', 410.00, 0.8],
                    ['AMZN', 'Amazon', 170.00, -0.6],
                    ['GOOGL', 'Alphabet', 135.00, 2.2],
                    ['META', 'Meta', 320.00, 1.1],
                    ['BRK.B', 'Berkshire Hathaway', 410.00, -0.2],
                    ['NVDA', 'NVIDIA', 650.00, 3.0],
                    ['JPM', 'JPMorgan Chase', 160.00, 0.4],
                    ['V', 'Visa', 250.00, 0.7],
                    ['TSLA', 'Tesla', 250.00, -1.3],
                ],
                dji: [
                    ['UNH', 'UnitedHealth', 520.00, 0.9],
                    ['GS', 'Goldman Sachs', 390.00, -0.4],
                    ['HD', 'Home Depot', 350.00, 1.2],
                    ['MSFT', 'Microsoft', 410.00, 0.8],
                    ['AAPL', 'Apple', 195.00, 1.5],
                    ['V', 'Visa', 250.00, 0.7],
                    ['JNJ', 'Johnson & Johnson', 160.00, -0.2],
                    ['PG', 'Procter & Gamble', 150.00, 0.3],
                    ['TRV', 'Travelers', 180.00, -0.5],
                    ['IBM', 'IBM', 170.00, 0.6],
                ],
                ixic: [
                    ['AAPL', 'Apple', 195.00, 1.5],
                    ['MSFT', 'Microsoft', 410.00, 0.8],
                    ['AMZN', 'Amazon', 170.00, -0.6],
                    ['GOOGL', 'Alphabet', 135.00, 2.2],
                    ['META', 'Meta', 320.00, 1.1],
                    ['NVDA', 'NVIDIA', 650.00, 3.0],
                    ['TSLA', 'Tesla', 250.00, -1.3],
                    ['AVGO', 'Broadcom', 1200.00, 0.9],
                    ['ADBE', 'Adobe', 600.00, 0.5],
                    ['PEP', 'PepsiCo', 180.00, -0.2],
                ],
                eur: [
                    ['SAP', 'SAP SE', 130.00, 1.0],
                    ['ASML', 'ASML Holding', 700.00, -0.7],
                    ['SAN', 'Sanofi', 90.00, 0.4],
                    ['OR', 'L\'Oreal', 400.00, 1.8],
                    ['RMS', 'Roche', 300.00, -0.3],
                    ['SIE', 'Siemens', 140.00, 0.6],
                    ['BAS', 'BASF', 60.00, -1.1],
                    ['DTE', 'Deutsche Telekom', 20.00, 0.2],
                    ['VOW3', 'Volkswagen', 200.00, 0.9],
                    ['ALV', 'Allianz', 220.00, -0.4],
                ]
            };

            // 初始化圖表
            let chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: indexData.twii.labels,
                    datasets: [{
                        label: indexData.twii.label,
                        data: indexData.twii.data,
                        borderColor: indexData.twii.color,
                        backgroundColor: 'rgba(0,123,255,0.1)',
                        tension: 0.3,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: true } },
                    scales: { y: { beginAtZero: false } }
                }
            });

            // 產生表格內容
            function renderStockTable(market) {
                const data = stockTableData[market] || [];
                let html = '';
                data.forEach(row => {
                    const [code, name, price, change] = row;
                    const up = change > 0;
                    const cls = up ? 'text-danger' : 'text-success';
                    const icon = up ? 'bi-caret-up-fill' : 'bi-caret-down-fill';
                    const sign = up ? '+' : '';
                    html += `<tr><td>${code}</td><td>${name}</td><td>${price.toLocaleString()}</td><td class="${cls}"><i class="bi ${icon}"></i> ${sign}${change}%</td></tr>`;
                });
                tableBody.innerHTML = html;
            }

            // 預設載入台灣市場
            renderStockTable('twii');

            // 側邊欄切換
            document.getElementById('index-list').addEventListener('click', function (e) {
                if (e.target.tagName === 'A' && e.target.dataset.index) {
                    e.preventDefault();
                    // 切換 active 樣式
                    document.querySelectorAll('#index-list .nav-link').forEach(link => link.classList.remove('active'));
                    e.target.classList.add('active');
                    // 取得資料
                    const idx = e.target.dataset.index;
                    const d = indexData[idx];
                    // 更新標題
                    chartTitle.textContent = d.title;
                    // 更新圖表
                    chart.data.labels = d.labels;
                    chart.data.datasets[0].label = d.label;
                    chart.data.datasets[0].data = d.data;
                    chart.data.datasets[0].borderColor = d.color;
                    chart.data.datasets[0].backgroundColor = d.color + '22'; // 淡色背景
                    chart.update();
                    // 更新 section title
                    const marketNames = {
                        twii: '台灣市場',
                        n225: '日本市場',
                        spx: 'S&P 500',
                        dji: '道瓊工業',
                        ixic: '納斯達克',
                        eur: '歐洲市場'
                    };
                    sectionTitle.textContent = (marketNames[idx] || d.title) + '主要股票';
                    // 更新表格
                    renderStockTable(idx);
                }
            });
            // ...可擴充API串接等
        });
    </script>
</body>

</html>